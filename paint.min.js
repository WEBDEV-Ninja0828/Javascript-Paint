function initSketchpad() {
    "use strict";
    var sketchpadEl = document.getElementById("sketchpad");
    var imageFilename = "images/" + Math.floor(Math.random() * 10) + ".png";
    var sketchpad = new Sketchpad({
        containerEl: sketchpadEl,
        features: {
            displayCrosshair: false,
            displayGrid: true
        },
        createPageConfig: {
            no: 1,
            backgroundColor: "rgba(250,250,250,1)",
            backgroundUrl: imageFilename
        }
    });
    window.sketchpad = sketchpad;

    function selectTool(toolId) {
        sketchpad.setTool(toolId);
        document.querySelectorAll(".toolbar .section").forEach(function(el) {
            el.classList.remove("active")
        });
        document.getElementById("tool-" + toolId).classList.add("active");
    }
    selectTool("line");
    sketchpad.getCurrentTool().setSize(4);
    
    document.getElementById('tool-highlighter').addEventListener("click", function() {
        document.getElementById('tool-highlighter-list').classList.add('showlist');
        document.getElementById('tool-line-list').classList.remove('showlist');
        selectTool("highlighter");
        sketchpad.getCurrentTool().setColor(0, 0, 0, 1);
        sketchpad.getCurrentTool().setSize(15);
    });
    document.getElementById('tool-eraser').addEventListener("click", function() {
        selectTool("eraser");
        document.getElementById('tool-line-list').classList.remove('showlist');
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
    });
    document.getElementById('tool-line').addEventListener("click", function() {
        document.getElementById('tool-line-list').classList.add('showlist');
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
        selectTool("line");
        sketchpad.getCurrentTool().setSize(4);
    });

    document.getElementById('tool-move-viewport').addEventListener("click", function () {
        selectTool("move-viewport");
    });

    document.getElementById('tool-zoom-in').addEventListener("click", function() {
        sketchpad.setScale(sketchpad.scale * 1.2);
        document.getElementById('tool-line-list').classList.remove('showlist');
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
    });

    document.getElementById('tool-zoom-1').addEventListener("click", function() {
        sketchpad.setScale(1);
        sketchpad.setViewportPosition(0, 0);
        sketchpad.setRotation(0);
        document.getElementById('tool-line-list').classList.remove('showlist');
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
    });
    document.getElementById('tool-zoom-out').addEventListener("click", function() {
        sketchpad.setScale(sketchpad.scale / 1.2);
        document.getElementById('tool-line-list').classList.remove('showlist');
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
    });
    document.getElementById('reset').addEventListener("click", function() {
        sketchpad = null;
        var node = document.getElementById("sketchpad");
        node.innerHTML = '';
        sketchpad = new Sketchpad({
            containerEl: sketchpadEl,
            features: {
                displayCrosshair: true,
                displayGrid: true
            },
            createPageConfig: {
                no: 1,
                backgroundColor: "rgba(250,250,250,1)",
                backgroundUrl: imageFilename
            }
        });
        selectTool('line');
        sketchpad.getCurrentTool().setSize(4);
        document.getElementById('tool-line-list').classList.remove('showlist');
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
    });

    document.getElementById('tool-line-black').addEventListener('click', function(e){
        selectTool('line');
        sketchpad.getCurrentTool().setColor(0, 0, 0, 1);
        sketchpad.getCurrentTool().setSize(4);
        document.getElementById('tool-line').style="color:black";
        document.getElementById('tool-line-list').classList.remove('showlist');
    });

    document.getElementById('tool-line-blue').addEventListener('click', function(e){
        selectTool('line');
        sketchpad.getCurrentTool().setColor(0, 0, 255, 1);
        sketchpad.getCurrentTool().setSize(4);
        document.getElementById('tool-line').style="color:blue";
        document.getElementById('tool-line-list').classList.remove('showlist');
    });

    document.getElementById('tool-line-red').addEventListener('click', function(e){
        selectTool('line');
        sketchpad.getCurrentTool().setColor(255, 0, 0, 1);
        sketchpad.getCurrentTool().setSize(4);
        document.getElementById('tool-line').style="color:red";
        document.getElementById('tool-line-list').classList.remove('showlist');
    });

    document.getElementById('tool-line-green').addEventListener('click', function(e){
        selectTool('line');
        sketchpad.getCurrentTool().setColor(0, 255, 0, 1);
        sketchpad.getCurrentTool().setSize(4);
        document.getElementById('tool-line').style="color:green";
        document.getElementById('tool-line-list').classList.remove('showlist');
    });

    document.getElementById('tool-highlighter-black').addEventListener('click', function(e){
        selectTool('highlighter');
        sketchpad.getCurrentTool().setColor(0, 0, 0, 1);
        sketchpad.getCurrentTool().setSize(15);
        document.getElementById('tool-highlighter').style="color:black";
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
    });

    document.getElementById('tool-highlighter-blue').addEventListener('click', function(e){
        selectTool('highlighter');
        sketchpad.getCurrentTool().setColor(0, 0, 255, 1);
        sketchpad.getCurrentTool().setSize(15);
        document.getElementById('tool-highlighter').style="color:blue";
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
    });

    document.getElementById('tool-highlighter-red').addEventListener('click', function(e){
        selectTool('highlighter');
        sketchpad.getCurrentTool().setColor(255, 0, 0, 1);
        sketchpad.getCurrentTool().setSize(15);
        document.getElementById('tool-highlighter').style="color:red";
        document.getElementById('tool-highlighter-list').classList.remove('showlist');
    });

    document.getElementById('tool-highlighter-green').addEventListener('click', function(e){
        selectTool('highlighter');
        sketchpad.getCurrentTool().setColor(0, 255, 0, 1);
        sketchpad.getCurrentTool().setSize(15);
        document.getElementById('tool-highlighter').style="color:green";
        document.getElementById('tool-highlighter-list').classList.remove('showlist');

    });
}
initSketchpad()